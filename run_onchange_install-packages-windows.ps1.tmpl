{{ if eq .chezmoi.os "windows" -}}

$TempFile = New-TemporaryFile

@'
{
    "$schema" : "https://aka.ms/winget-packages.schema.2.0.json",
    "Sources" :
    [
        {
            "Packages" :
            [
{{- range .packages.windows.winget }}
                {
                    "PackageIdentifier" : {{ . | quote }}
                },
{{- end }}
            ],
            "SourceDetails" :
            {
                "Argument" : "https://cdn.winget.microsoft.com/cache",
                "Identifier" : "Microsoft.Winget.Source_8wekyb3d8bbwe",
                "Name" : "winget",
                "Type" : "Microsoft.PreIndexed.Package"
            }
        }
    ]
}
'@ | Out-File $TempFile

winget import -i $TempFile --ignore-unavailable --no-upgrade

Remove-Item $TempFile
{{ end -}}

# vim:ft=ps1
